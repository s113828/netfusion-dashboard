<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NetFusion Dashboard - æ™ºèƒ½æ±ºç­–ä¸­å¿ƒ</title>

    <!-- Premium Typography: Outfit + Space Grotesk + Noto Sans TC -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800;900&family=Space+Grotesk:wght@500;600;700&family=Noto+Sans+TC:wght@400;500;600;700;900&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="landing-v2.css">
    <link rel="stylesheet" href="dashboard-v2.css">
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- PDF Export Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body class="dashboard-page">
    <!-- Global Loading Indicator -->
    <div id="global-loader" style="display: none; position: fixed; top: 0; left: 0; right: 0; height: 3px; z-index: 9999;">
        <div class="loading-bar" style="height: 100%; background: linear-gradient(90deg, #38bdf8, #a855f7, #38bdf8); background-size: 200% 100%; animation: shimmer 1.5s infinite;"></div>
    </div>
    <style>
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        @keyframes pulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 0.8; } }
        .skeleton { background: linear-gradient(90deg, var(--color-surface) 25%, rgba(56,189,248,0.1) 50%, var(--color-surface) 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; border-radius: 4px; }
        .skeleton-text { height: 20px; margin: 4px 0; }
        .skeleton-value { height: 36px; width: 120px; margin: 8px 0; }
        .export-menu button:hover { background: rgba(56,189,248,0.1); }
        .btn-secondary:disabled, .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
        .refresh-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .toast { position: fixed; bottom: 24px; right: 24px; padding: 12px 20px; background: var(--color-card); border: 1px solid var(--color-border); border-radius: 8px; z-index: 9999; display: flex; align-items: center; gap: 10px; animation: slideIn 0.3s ease; }
        .toast.success { border-color: #22c55e; }
        .toast.error { border-color: #ef4444; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <!-- Connect Overlay (Unauthorized State) -->
    <div id="connect-overlay"
        style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); z-index: 1000; display: flex; align-items: center; justify-content: center; text-align: center;">
        <div class="data-card" style="max-width: 500px; padding: 40px; border-color: var(--color-primary);">
            <div style="font-size: 64px; margin-bottom: 20px;">ğŸ›¡ï¸</div>
            <h2 style="font-family: var(--font-display); margin-bottom: 16px;">å•Ÿå‹• AI æ•¸æ“šåˆ†æ</h2>
            <p style="color: var(--color-text-secondary); margin-bottom: 32px;">è«‹é€£çµæ‚¨çš„ Google Search Console å¸³æˆ¶ï¼ŒNetFusion
                AI å°‡è‡ªå‹•ç‚ºæ‚¨ç”¢å‡ºæ·±åº¦ SEO è¨ºæ–·å ±å‘Šã€‚</p>
            <button class="btn-primary" onclick="location.href='/auth/google'" style="width: 100%; padding: 16px;">
                ç«‹å³é€£çµ GSC å¸³æˆ¶
            </button>
        </div>
    </div>

    <div class="dashboard-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="/" class="logo">
                    <svg class="logo-icon" width="32" height="32" viewBox="0 0 32 32" fill="none">
                        <defs>
                            <linearGradient id="logoGradDash" x1="0" y1="0" x2="32" y2="32">
                                <stop offset="0%" stop-color="#38bdf8" />
                                <stop offset="100%" stop-color="#0ea5e9" />
                            </linearGradient>
                        </defs>
                        <rect width="32" height="32" rx="8" fill="url(#logoGradDash)" />
                        <path d="M8 22V10L16 18V10" stroke="#030712" stroke-width="2.5" stroke-linecap="round"
                            stroke-linejoin="round" fill="none" />
                    </svg>
                    <span class="logo-text">NetFusion</span>
                </a>
            </div>

            <nav class="nav-menu">
                <a href="#" class="nav-item active">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7" />
                        <rect x="14" y="3" width="7" height="7" />
                        <rect x="14" y="14" width="7" height="7" />
                        <rect x="3" y="14" width="7" height="7" />
                    </svg>
                    <span>ä¸»æ§é¢æ¿</span>
                </a>
                <a href="#" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    <span>SEO é—œéµå­—</span>
                </a>
                <a href="#" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 20V10M18 20V4M6 20v-4" />
                    </svg>
                    <span>æµé‡å ±è¡¨</span>
                </a>
                <a href="#" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path
                            d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.364-6.364l-.707-.707M4.05 18.05l.707.707M19.95 18.05l-.707.707" />
                    </svg>
                    <span>AI æ±ºç­–å»ºè­°</span>
                </a>
            </nav>

            <div class="sidebar-footer" style="padding: 20px; border-top: 1px solid var(--color-border);">
                <div class="user-info" style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                    <div id="user-avatar"
                        style="width: 32px; height: 32px; border-radius: 50%; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; font-weight: bold; color: black;">
                        N</div>
                    <div>
                        <div id="user-name" style="font-size: 14px; font-weight: 600;">ç®¡ç†è€…</div>
                        <div id="user-email" style="font-size: 12px; color: var(--color-text-muted);">Pro æ–¹æ¡ˆ</div>
                    </div>
                </div>
                <button id="btn-logout" class="btn-secondary" style="width: 100%; padding: 8px; font-size: 12px; display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"/>
                    </svg>
                    ç™»å‡º
                </button>
            </div>
        </aside>

        <!-- Main Area -->
        <main class="main-area">
            <header class="topbar">
                <div class="topbar-left" style="display: flex; align-items: center; gap: 20px;">
                    <button class="mobile-menu-btn" id="mobile-menu-btn" aria-label="é–‹å•Ÿé¸å–®">â˜°</button>
                    <h2 style="margin: 0; font-family: var(--font-display);">æ•¸æ“šç‰†</h2>
                    <select id="site-selector" class="date-select"
                        style="background: var(--color-surface); color: white; border: 1px solid var(--color-border); padding: 8px 16px; border-radius: 8px; font-family: var(--font-body); cursor: pointer;">
                        <option value="">æ­£åœ¨è¼‰å…¥ç«™é»...</option>
                    </select>
                </div>
                <div class="topbar-right" style="display: flex; gap: 8px; flex-wrap: wrap;">
                    <!-- Date Range Selector -->
                    <select id="date-range" class="date-select"
                        style="background: var(--color-surface); color: white; border: 1px solid var(--color-border); padding: 8px 12px; border-radius: 8px; font-size: 12px; cursor: pointer;">
                        <option value="7">æœ€è¿‘ 7 å¤©</option>
                        <option value="14">æœ€è¿‘ 14 å¤©</option>
                        <option value="28" selected>æœ€è¿‘ 28 å¤©</option>
                        <option value="90">æœ€è¿‘ 90 å¤©</option>
                    </select>
                    <!-- Refresh Button -->
                    <button class="btn-secondary" id="btn-refresh" style="padding: 8px 12px;" title="é‡æ–°æ•´ç†è³‡æ–™">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                        </svg>
                    </button>
                    <!-- Export Dropdown -->
                    <div class="export-dropdown" style="position: relative;">
                        <button class="btn-secondary" id="btn-export" style="padding: 8px 12px; display: flex; align-items: center; gap: 6px;">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                            </svg>
                            åŒ¯å‡º
                        </button>
                        <div id="export-menu" class="export-menu" style="display: none; position: absolute; right: 0; top: 100%; margin-top: 4px; background: var(--color-card); border: 1px solid var(--color-border); border-radius: 8px; min-width: 140px; z-index: 100; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                            <button id="btn-export-pdf" style="width: 100%; padding: 10px 16px; text-align: left; background: none; border: none; color: white; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 8px;">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                                PDF å ±è¡¨
                            </button>
                            <button id="btn-export-csv" style="width: 100%; padding: 10px 16px; text-align: left; background: none; border: none; color: white; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 8px;">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3v12M3 12h18M17 17H7l5 5 5-5z"/></svg>
                                CSV è³‡æ–™
                            </button>
                        </div>
                    </div>
                    <button class="btn-primary" id="btn-reauth" style="padding: 8px 12px; font-size: 12px;">
                        é‡æ–°æˆæ¬Š
                    </button>
                </div>
            </header>

            <div class="content-body">
                <!-- Metrics Grid -->
                <div class="metrics-grid">
                    <div class="data-card">
                        <span class="card-label">ç¸½é»æ“Šæ¬¡æ•¸ (Clicks)</span>
                        <div class="card-value" id="stat-clicks">--</div>
                        <div class="card-trend trend-up">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M5 15l7-7 7 7" />
                            </svg>
                            <span>GSC åŒæ­¥</span>
                        </div>
                    </div>
                    <div class="data-card">
                        <span class="card-label">ç¸½æ›å…‰æ¬¡æ•¸ (Impressions)</span>
                        <div class="card-value" id="stat-impressions">--</div>
                        <div class="card-trend trend-up">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M5 15l7-7 7 7" />
                            </svg>
                            <span>GSC åŒæ­¥</span>
                        </div>
                    </div>
                    <div class="data-card">
                        <span class="card-label">å¹³å‡æ’å (Avg Position)</span>
                        <div class="card-value" id="stat-position">--</div>
                        <div class="card-trend" id="stat-ctr-label">
                            <span style="color: var(--color-text-muted);">CTR: </span>
                            <span id="stat-ctr"
                                style="color: var(--color-primary); font-weight: bold; margin-left: 5px;">--%</span>
                        </div>
                    </div>
                </div>

                <!-- AI Recommendations -->
                <section class="ai-section">
                    <div style="display: flex; gap: 20px; align-items: flex-start; margin-bottom: 24px;">
                        <img src="cyber_feature.webp" alt="AI System"
                            style="width: 64px; height: 64px; border-radius: 12px; border: 1px solid var(--color-border-hover); box-shadow: var(--shadow-glow);">
                        <div class="ai-header" style="margin-bottom: 0; flex: 1;">
                            <h3 style="margin: 0; font-family: var(--font-display);">ğŸ’¡ NetFusion AI ç­–ç•¥å»ºè­°</h3>
                            <span class="rec-badge badge-high"
                                style="background: rgba(56, 189, 248, 0.1); color: var(--color-primary);">3
                                å€‹é«˜å„ªå…ˆè¡Œå‹•</span>
                        </div>
                    </div>

                    <div class="recommendations-list">
                        <div class="rec-card">
                            <div class="rec-info">
                                <h4 style="margin: 0 0 4px 0;">é—œéµå­—æ’åå„ªåŒ–æ©Ÿæœƒ</h4>
                                <p style="margin: 0; color: var(--color-text-secondary); font-size: 14px;">é—œéµå­—ã€Œè¡ŒéŠ·è‡ªå‹•åŒ–ã€æ’åç¬¬
                                    11ï¼Œå„ªåŒ– Meta Title å¯é¡¯è‘—æå‡é»æ“Šç‡ã€‚</p>
                            </div>
                            <button class="btn-secondary" style="padding: 8px 16px;">ç«‹å³æ‡‰ç”¨</button>
                        </div>
                        <div class="rec-card" style="border-left-color: var(--color-secondary);">
                            <div class="rec-info">
                                <h4 style="margin: 0 0 4px 0;">å…§å®¹é•·åº¦ä¸è¶³è­¦å‘Š</h4>
                                <p style="margin: 0; color: var(--color-text-secondary); font-size: 14px;">é é¢
                                    /blog/seo-tips å…§å®¹å°‘æ–¼ 500 å­—ï¼Œå»ºè­°æ“´å¢ä»¥ç²å¾—æ›´é«˜æ¬Šé‡ã€‚</p>
                            </div>
                            <button class="btn-secondary" style="padding: 8px 16px;">æ’°å¯«å»ºè­°</button>
                        </div>
                    </div>
                </section>

                <!-- Chart Placeholder -->
                <div class="chart-container">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h3 style="margin: 0; font-family: var(--font-display);">æœå°‹æµé‡è¶¨å‹¢</h3>
                        <div style="font-size: 12px; color: var(--color-text-muted); display: flex; gap: 16px;">
                            <span>
                                <span style="display: inline-block; width: 10px; height: 10px; background: #38bdf8; margin-right: 4px; border-radius: 2px;"></span>
                                é»æ“Šæ•¸
                            </span>
                            <span>
                                <span style="display: inline-block; width: 10px; height: 10px; background: #a855f7; margin-right: 4px; border-radius: 2px;"></span>
                                æ›å…‰æ•¸
                            </span>
                        </div>
                    </div>
                    <div style="height: 300px; position: relative;">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>

                <!-- Keywords & Pages Section -->
                <div class="data-card" style="margin-top: 24px; width: 100%; overflow: hidden;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0; font-family: var(--font-display);">ç«¶çˆ­åŠ›åˆ†æ</h3>
                        <div class="tab-buttons" style="display: flex; gap: 10px;">
                            <button id="btn-show-keywords" class="btn-primary"
                                style="padding: 6px 12px; font-size: 12px;">ç†±é–€é—œéµå­—</button>
                            <button id="btn-show-pages" class="btn-secondary"
                                style="padding: 6px 12px; font-size: 12px;">ç†±é–€é é¢</button>
                        </div>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table" id="keywords-table">
                            <thead>
                                <tr>
                                    <th>é—œéµå­— (Query)</th>
                                    <th>é»æ“Š</th>
                                    <th>CTR</th>
                                    <th>å¹³å‡æ’å</th>
                                </tr>
                            </thead>
                            <tbody id="keywords-table-body">
                                <tr>
                                    <td colspan="4" style="padding: 20px; text-align: center;">è¼‰å…¥ä¸­...</td>
                                </tr>
                            </tbody>
                        </table>

                        <table class="data-table" id="pages-table" style="display: none;">
                            <thead>
                                <tr>
                                    <th>ç¶²é è·¯å¾‘ (Page URL)</th>
                                    <th>é»æ“Š</th>
                                    <th>æ›å…‰</th>
                                    <th>å¹³å‡æ’å</th>
                                </tr>
                            </thead>
                            <tbody id="pages-table-body">
                                <tr>
                                    <td colspan="4" style="padding: 20px; text-align: center;">è¼‰å…¥ä¸­...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="js/supabase.js"></script>
    <script src="app.js"></script>
</body>

</html>